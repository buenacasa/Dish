<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Profile</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        .profile { max-width: 600px; margin: 0 auto; }
        .profile img { width: 100%; height: 300px; object-fit: cover; border-radius: 8px; }
        .profile h1 { margin: 20px 0 10px; }
        .profile a { color: #007bff; text-decoration: none; }
        .profile a:hover { text-decoration: underline; }
        .back { margin-bottom: 20px; }
        .map-icon { width: 24px; height: 24px; vertical-align: middle; }
        @media (max-width: 600px) { .profile img { height: 200px; } }
    </style>
</head>
<body>
    <a href="javascript:history.back()" class="back">Back to Restaurants</a>
    <div id="profile" class="profile"></div>

    <script>
        const restaurantUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSnHOqrshe73kAA0Sju9du36ApJckFMzeZhypLXmsCd2klE9PTK0SGC3-3COWAQ5oomjWYNLgiGi4ai/pub?gid=499357101&single=true&output=csv";
        const urlParams = new URLSearchParams(window.location.search);
        const restaurantId = urlParams.get("restaurant");

        async function fetchCSV(url) {
            const response = await fetch(url);
            const text = await response.text();
            return text.split("\n").map(row => row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/));
        }

        async function loadProfile() {
            const data = await fetchCSV(restaurantUrl);
            const profile = document.getElementById("profile");
            for (let i = 1; i < data.length; i++) {
                const row = data[i];
                if (row[1] === restaurantId) {
                    const name = row[2];
                    const keywords = row[3]?.replace(/"/g, "").replace(/\r/g, "").split(",").map(k => k.trim()) || [];
                    const chain = row[4];
                    const address = row[5]?.replace(/"/g, "");
                    const neighborhood = row[7];
                    const mapsLink = row[8];
                    const profilePic = row[9];

                    const keywordLinks = keywords.map(k => `<a href="restaurants.html?cuisine=${k}">${k}</a>`).join(", ");
                    profile.innerHTML = `
                        <img src="${profilePic}" alt="${name}">
                        <h1>${name}</h1>
                        <p><strong>Cuisine:</strong> ${keywordLinks}</p>
                        <p><strong>Chain:</strong> ${chain}</p>
                        <p><strong>Address:</strong> ${address}</p>
                        <p><strong>Neighborhood:</strong> ${neighborhood}</p>
                        <p><strong>Location:</strong> 
                            <a href="${mapsLink}" target="_blank">
                                <img src="https://maps.google.com/mapfiles/ms/icons/red-dot.png" class="map-icon" alt="Map">
                            </a>
                        </p>
                    `;
                    break;
                }
            }
        }

        loadProfile();
    </script>
</body>
</html>
